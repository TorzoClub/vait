{"version":3,"file":"vait.esm.js","sources":["../src/index.ts"],"sourcesContent":["type VaitReturn<T extends unknown, ErrorType = Error> = Promise<T> & {\n  __isVait__: true;\n  __finally__: boolean;\n  __value__: T;\n  __error__?: ErrorType;\n  pass(val: T): void;\n  fail(err: Error): void;\n};\ntype TimeoutReturn<T extends unknown> = VaitReturn<T, Error> & { clear(): void }\ninterface IVait {\n  <T extends unknown, ErrorType>(): VaitReturn<T, ErrorType>;\n\n  timeout<T extends unknown>(timing: string | number, value?: T): TimeoutReturn<T>;\n  nextTick(): TimeoutReturn<undefined>;\n  wait<T extends unknown>(promise: Promise<T>): VaitReturn<T>;\n}\n\nconst Vait: IVait = <T extends unknown, ErrorType = Error>() => {\n  let pass, fail\n\n  const promise = new Promise<T>((resolve, reject) => {\n    pass = (value: T) => {\n      promise.__finally__ = true\n      promise.__value__ = value\n      resolve(value)\n    }\n\n    fail = (error: ErrorType) => {\n      promise.__finally__ = true\n      promise.__error__ = error\n      reject(error)\n    }\n  }) as VaitReturn<T, ErrorType>;\n\n  Object.assign(promise, {\n    __isVait__: true,\n    __finally__: false,\n    pass,\n    fail\n  })\n\n  return promise\n}\n\nVait.timeout = <T extends unknown>(timing: string | number, value = undefined) => {\n  const v = Vait<T, Error>();\n\n  const timeout_handle = setTimeout(v.pass, parseInt(`${timing}`), value)\n\n  const vv: TimeoutReturn<T> = Object.assign(v, {\n    clear: () => clearTimeout(timeout_handle)\n  });\n\n  return vv;\n}\n\nVait.nextTick = () => Vait.timeout<undefined>(0);\n\nVait.wait = <T extends unknown>(promise: Promise<T>) => {\n  const v = Vait<T, Error>()\n  promise.then(v.pass).catch(v.fail)\n  return v\n}\n\nexport default Vait;\n// // module.exports = Vait\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAiBA,IAAM,IAAI,GAAU;IAClB,IAAI,IAAI,EAAE,IAAI,CAAA;IAEd,IAAM,OAAO,GAAG,IAAI,OAAO,CAAI,UAAC,OAAO,EAAE,MAAM;QAC7C,IAAI,GAAG,UAAC,KAAQ;YACd,OAAO,CAAC,WAAW,GAAG,IAAI,CAAA;YAC1B,OAAO,CAAC,SAAS,GAAG,KAAK,CAAA;YACzB,OAAO,CAAC,KAAK,CAAC,CAAA;SACf,CAAA;QAED,IAAI,GAAG,UAAC,KAAgB;YACtB,OAAO,CAAC,WAAW,GAAG,IAAI,CAAA;YAC1B,OAAO,CAAC,SAAS,GAAG,KAAK,CAAA;YACzB,MAAM,CAAC,KAAK,CAAC,CAAA;SACd,CAAA;KACF,CAA6B,CAAC;IAE/B,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE;QACrB,UAAU,EAAE,IAAI;QAChB,WAAW,EAAE,KAAK;QAClB,IAAI,MAAA;QACJ,IAAI,MAAA;KACL,CAAC,CAAA;IAEF,OAAO,OAAO,CAAA;AAChB,CAAC,CAAA;AAED,IAAI,CAAC,OAAO,GAAG,UAAoB,MAAuB,EAAE,KAAiB;IAAjB,sBAAA,EAAA,iBAAiB;IAC3E,IAAM,CAAC,GAAG,IAAI,EAAY,CAAC;IAE3B,IAAM,cAAc,GAAG,UAAU,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,KAAG,MAAQ,CAAC,EAAE,KAAK,CAAC,CAAA;IAEvE,IAAM,EAAE,GAAqB,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE;QAC5C,KAAK,EAAE,cAAM,OAAA,YAAY,CAAC,cAAc,CAAC,GAAA;KAC1C,CAAC,CAAC;IAEH,OAAO,EAAE,CAAC;AACZ,CAAC,CAAA;AAED,IAAI,CAAC,QAAQ,GAAG,cAAM,OAAA,IAAI,CAAC,OAAO,CAAY,CAAC,CAAC,GAAA,CAAC;AAEjD,IAAI,CAAC,IAAI,GAAG,UAAoB,OAAmB;IACjD,IAAM,CAAC,GAAG,IAAI,EAAY,CAAA;IAC1B,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;IAClC,OAAO,CAAC,CAAA;AACV,CAAC,CAAA;AAED,kBAAe,IAAI,CAAC;AACpB;;;;;;;;"}